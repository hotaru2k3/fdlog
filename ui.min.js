function handle_sections(c){var b,d,a,e;for(b in c){$("#area_"+b).append("<ul>");a=$("<ul>");for(d in c[b]){$("#section").append('<option value="'+d+'">'+d+"</option>");a.append('<li id="'+d+'"><abbr title="'+c[b][d]+'">'+d+"</abbr></li>")}if(b!="DX"){$("#area_"+b).append(a)}}e=$("#section").children("option");e.sort(function(g,f){if(g.value>f.value){return 1}if(g.value<f.value){return -1}return 0});e.detach().appendTo($("#section"));$("#section").val("")}function handle_status(a){$("#last20 tbody tr").remove();$.each(a.last20,function(c,b){var d=$("<tr>");$.each(b,function(e,f){if(e==2){if(f=="PH"){f="Phone"}if(f=="DIG"){f="Digital"}}else{if(e==5){f=(new Date(f*1000)).toISOString().substring(11,19)}}d.append($("<td>"+f+"</td>"))});$("#last20 tbody").append(d)});$("li").removeClass("worked");$.each(a.sections_worked,function(b,c){$("#"+c).addClass("worked")})}function submit_form(){if($("#call").hasClass("dup")){alert("Duplicate!");return false}var a={call:$("#call").val(),band:$("#band").val(),mode:$("#mode").val(),"class":$("#class").val(),section:$("#section").val(),operator:$("#operator").val(),logger:$("#logger").val()};$.post("add.pl",a,handle_status,"json");$("#call").val("");$("#class").val("");$("#section").val("");return false}$(document).ready(function(){$("#operator").val($.cookie("operator"));$("#logger").val($.cookie("logger"));$("#band").val($.cookie("band"));$("#mode").val($.cookie("mode"));$(log_form).submit(submit_form);$.getJSON("data/sections.json",{},handle_sections);var a=new EventSource("status.pl");a.addEventListener("message",function(b){handle_status(JSON.parse(b.data))});$("#operator").change(function(){var b=$("#operator").val().toUpperCase();$("#operator").val(b);$.cookie("operator",b,{expires:7})});$("#logger").change(function(){var b=$("#logger").val().toUpperCase();$("#logger").val(b);$.cookie("logger",b,{expires:7})});$("#band").change(function(){$.cookie("band",$("#band").val(),{expires:7})});$("#mode").change(function(){$.cookie("mode",$("#mode").val(),{expires:7})});$("#call").change(function(){$("#call").val($("#call").val().toUpperCase());$("#call").removeClass("dup");$("#class").removeClass("dup");$("#section").removeClass("dup");$.getJSON("dup.pl",{call:$("#call").val()},function(b){if(b.length){$("#class").val(b[3]);$("#section").val(b[4]);if(b[1]==$("#band").val()&&b[2]==$("#mode").val()){$("#call").addClass("dup");$("#class").addClass("dup");$("#section").addClass("dup")}}})});$("#class").change(function(){$("#class").val($("#class").val().toUpperCase())})});